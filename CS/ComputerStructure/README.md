# ComputerStructure

  - [1. 시스템버스란](#시스템-버스란)
  - [2. CPU의 구조와 기능](#2-cpu의-구조와-기능)
    - [CPU의 기본 구조](#cpu의-기본-구조)
    - [명령어 실행](#명령어-실행)
      - [인출 사이클](#인출-사이클)
      - [실행 사이클](#실행-사이클)
    - [인터럽트](#인터럽트)
    - [다중 인터럽트](#다중-인터럽트)
    - [간접 사이클](#간접-사이클)


</br>

## 1. 시스템버스란
시스템 버스는 CPU와 다른 요소들 간의 정보교환 통로이다. 시스템 버스는 3가지 '하부 버스'로 구성된다.
<br>  
1. 주소 버스(address bus)  
CPU가 외부로 발생하는 주소 정보를 전송하는 신호 선들의 집합이다. 
2. 데이터 버스(data bus)  
CPU가 기억장치 혹은 I/O 장치와의 사이에 데이터를 전송하기 위한 신호 선들의 집합이다.
3. 제어 버스(control bus)  
시스템 내의 각종 요소들의 동작을 제어하는데 필요한 신호 선들의 집합이다. 

## 2. CPU의 구조와 기능
### CPU의 기본 구조
CPU는 기억장치에 저장되어 있는 프로그램 코드인 명령어들을 실행함으로써 프로그램 수행이라는 컴퓨터의 기본적인 기능을 수행하는데, 이를위해 CPU가 수행하는 세부적인 동작들을 순서대로 나열하면 아래와 같다.

1. 명령어 인출 : 기억장치로부터 명령어를 읽어온다.
2. 명령어 해독 : 수행해야 할 동작을 결정하기 위하여 명령어를 해독한다.
3. 데이터 인출 : 데이터가 필요한 경우에는 기억장치 혹은 I/O 장치로부터 데이터를 읽어온다.
4. 데이터 처리 : 데이터에 대한 산술적 혹은 논리적 연산을 수행한다.
5. 데이터 저장 : 명령어를 수행한 결과를 저장한다.

이러한 동작들을 수행하기 위해 CPU는 아래와 같은 내부 구성 요소들로 이루어져 있다.  

1. ALU  
각종 산술 연산들과 논리 연산들을 수행하는 회로들로 이루어진 하드웨어 모듈이다.  

2. 레지스터 세트  
CPU 내부에 위치한 기억장치로서, 액세스 속도가 컴퓨터의 기억장치들 중에서 가장 빠르다. 

3. 제어 유니트  
명령어를 해석하고, 그것을 실행하기 위한 제어 신호들을 순차적으로 발생시키는 하드웨어 모듈이다.  
명령어 실행에 필요한 각종 정보들의 전송 통로와 방향을 지정해주고, CPU 내부 요소들과 시스템 구성 요소들의 동작 시간도 결정해준다.

4. CPU 내부 버스  
ALU와 레지스터들 간의 데이터 이동을 위한 데이터 선들과 주소 선들, 그리고 제어 유니트로부터 발생되는 제어 신호들을 전송하는 선들로 구성된다. 

### 명령어 실행
CPU가 한 개의 명령어를 실행하는 데 필요한 전체 과정을 '명령어 사이클'이라고 부른다. 그리고 명령어 사이클은 CPU가 기억장치로부터 명령어를 읽어 오는 '명령어 인출' 단계와 인출된 명령어를 실행하는 '명령어 실행' 단계로 이루어진다.  

명령어를 실행하기 위하여 기본적으로 필요한 CPU 레지스터들은 아래와 같다.  
1. 프로그램 카운터 (PC)  
다음에 인출될 명령어의 주소를 가지고 있는 레지스터이다. 각 명령어가 인출된 후에는 그 내용이 자동적으로 1이 증가된다. 
2. 누산기 (AC)  
데이터를 일시적으로 저장하는 레지스터이다. 이 레지스터의 비트 수는 CPU가 한번에 연산 처리할 수있는 데이터 비트 수와 같다.
3. 명령어 레지스터 (IR)  
가장 최근에 인출된 명령어가 저장되어 있는 레지스터이다.
4. 기억장치 주소 레지스터 (MAR)   
프로그램 카운터에 저장된 명령어 주소가 시스템 주소 버스로 출력되기 전에 일시적으로 저장되는 주소 레지스터이다. 
5. 기억장치 버퍼 레지스터 (MBR)  
기억장치에 저장될 데이터 혹은 기억장치로부터 읽혀진 데이터가 일시적으로 저장되는 버퍼 레지스터이다.

#### 인출 사이클
기억장치의 지정된 위치로부터 명령어를 읽어오는 과정을 인출 사이클이라고 부른다.  
CPU는 각 명령어 사이클의 시작 단계에서 프로그램 카운터(PC)가 가리키는 기억장치의 위치로부터 명령어를 인출해 온다. 그런 다음 CPU는 PC의 내용을 1씩 증가시킴으로써 명령어들을 기억장치에 저장되어 있는 순서대로 읽어올 수 있도록 해준다. 

#### 실행 사이클
실행 사이클은 CPU가 인출된 명령어 코드를 '해독(decode)'하고, 그 결과에 따라 필요한 연산을 수행하는 것을 말한다. 

<br>

### 인터럽트
CPU로 하여금 현재 진행 중인 프로그램 처리를 중단하고 다른 프로그램을 처리하도록 요구하는 매커니즘을 인터럽트라고 부른다.
<br>
<br>
인터럽트는 CPU와 외부 장치들 간의 상호작용을 위해 필요한 기능이다.  
하지만, 이는 main 프로그램의 관점에서 단순히 정상적인 프로그램 처리의 흐름을 방해하는 동작이다. 그럼에도 인터럽트는 긴급한 상황에 대처하거나 외부 장치들과의 상호 작용을 위하여 반드시 필요한 기능이다. 

CPU가 어떤 프로그램을 순차적으로 수행하는 도중에 외부로부터 인터럽트 요구가 들어오게 되면, CPU는 원래의 프로그램 수행을 중단하고, 요구된 인터럽트를 처리해주기 위한 프로그램을 먼저 수행한다.  
그리고 인터럽트에 대한 처리가 끝나면, CPU는 원래의 프로그램으로 복귀(return)하여 수행을 계속한다.

<br>
CPU는 인터럽트 요구가 들어오면 그것을 인식할 수있어야 하며, 어떤 장치가 인터럽트를 요구하였는지 확인하여 해당 인터럽트 서비스 루틴을 수행하고, 중단했던 원래 프로그램의 수행을 계속할 수있어야 한다.   
<br>
이를위해 CPU는 각 명령어의 실행 사이클을 종료하고 다음 명령어를 위한 인출 사이클을 시작하기 전에, 인터럽트 요구 신호가 들어와서 대기중인지 검사해야 한다. 만약 인터럽트 요구가 들어온 상태라면, CPU는 아래와 같은 동작들을 수행한다.  

<br>
<br>

1. 현재의 PC 내용을 '스택'에 저장한다. 이것은 인터럽트 처리를 완료한 후에 복귀할 주소를 저장해두기 위한 절차이다.  
2. 인터럽트 서비스 루틴을 호출하기 위하여 그 루틴의 시작 주소를 PC에 적재한다. 이때 시작 주소는 인터럽트를 요구한 장치로부터 전송된다. 


### 다중 인터럽트
어떤 외부 장치를 위한 인터럽트 서비스 루틴의 명령어들이 실행되고 있는 동안에 다른 외부 장치가 인터럽트 요구를 발생할 수도 있는데, 이것이 '다중 인터럽트'이다.  
다중 인터럽트를 처리하는 방법으로는 두 가지가 있다.  

1. CPU가 인터럽트 서비스 루틴을 처리하고 있는 도중에 새로운 인터럽트 요구가 들어오더라도 인터럽트 사이클을 수행하지 않도록 하는 방법
2. 인터럽트에 우선순위를 지정하는 방법

### 간접 사이클
어떤 연산을 수행하는 경우 데이터가 기억장치에 저장되어 있다면, 명령어에는 그 데이터를 읽어오기 위한 기억장치 주소가 포함되어 있을 것이다. 그런데 어떤 명령어의 경우 포함하고 있는 주소가 데이터의 주소가 아니라, 데이터가 저장된 '기억장소의 주소'를 가리킨다.  
<br>
연산에서 사용될 데이터의 주소가 기억장치의 어떤 위치에 저장되어 있고, 명령어에 포함되어 있는 주소는 그 위치를 가리키는 것이다.
<br>
이 경우에는 실행 사이클이 시작되기 전에, 그 데이터의 실제 주소를 기억장치로부터 읽어오는 과정이 먼저 수행되어야 한다.